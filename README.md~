# tf-files 

This is a terraform plan that creates a two-tier VPC and instantiates a server.

1) Create VPC and VPC components
2) Create a Security Group
3) Create a key pair - commented as we'll use existing key
4) Instantiate the server
5) As part of instantiation, assign the sg created earlier and add a public IP

## tf-files Install Instructions

1. Change directory to the location you want your terraform plan to be, usually your home directory

2. Using the git command-line:

```
git clone https://github.com/AndrewSimon/tf-files
```

## Terraform Install Instructions:

```
https://www.terraform.io/intro/getting-started/install.html
```

### tf-files Configuration Instructions:

auth.tf:  modify public_key_path and key_name to match your environment
main.tf:  modify key_name to an SSH key pair you already created in AWS


#### Edit the vui/code/config.php configuration file
- Follow the instructions in the configuration file.
- Vagrant will be run from wherever you define the VAGRANT_HOME directory to be.
- Typically, you set the VAGRANT_HOME to what is defined for the web account id home as specified in /etc/passwd but it can be any path with sufficient space and appropriate directory permission. 

#### Modify Directory Permission on the vui install path AND the VAGRANT_HOME path
- Set permission on VAGRANT_HOME directory and the VAGRANT_URI actual path (not the alias) for the web account to own them, with read, write and execute access. 
- Allocate lots of space to the VAGRANT_HOME directory! Box files and drive images can gobble up quite a huge amount of disk space.

#### Initialize your VUI environment and install any plugins (if needed).
- In your web browser, go to the VUI URL you defined
- VUI will guide you through initializing the environment
- Click 'Initialize Environment'.  If VUI reports errors, correct them.  Most will be config.php or permission related
- If you just modified a directory permission or edited config.php, refresh the browser instead of clicking 'Next'
- If prompted, correct new problems or click 'Next; otherwise initializing the environment is done.
- Once done, you do not need to have boxes added, just use a HashiCorp URL for a box
- When performing any Vagrant tasks on command-line, ONLY USE THE WEB DAEMON ACCOUNT ID
- The option to add boxes locally via VUI is in progress
- Vagrant ships with virtualbox, docker and hyperv providers. Many other providers are available via plugin download.  Download of (most) plugins and installation is handled through VUI
- VMWare and other providers are not free, and will require a gem or plugin install, a license, and possible other steps. Follow the 'Trouble-shooting' steps below on how to do run command-line steps outside of Vagrant UI (VUI).
- Similarly, box files must be added by hand (for now), see 'Trouble-Shooting' guide on how to run commands as the Web Daemon user.

### Running command-line Vagrant options and Trouble-shooting as the Web Daemon account id

- Temporarily, change the web daemon account id shell to /bin/bash
- To add a box file, download the box file, change permission on it, as root where ```<id>``` is the web daemon id,  run ```su - <id> -c "cd /path/to/vagrant/home && vagrant box add /path/to/boxfile --name name_of_box_file"```
- For other vagrant commands as the web daemon, run ```su - <id> -c "cd /path/to/vagrant/home && vagrant <command> <opts>```
- For basic environment trouble-shooting, run: ```su - <id> -c "cd /path/to/vagrant/home && vagrant"```
- The output may describe missing dependencies or files, or may prompt for actions
- If prompted, it may want to 'rebuild' the vagrant environment. Answer "Yes" to do so
- Once your environment is OKAY, vagrant may still issue messages which appear on command line regarding Vagrantfile, provider, provisioner, box file, etc.  Warnings and errors of this type will also appear in VUI. 
- Many/most non-environment errors can be remedied in changes to the Vagrantfile (e.g. specifying a different provider).
- Run ```vagrant help``` as any id to see commands related to box files, providers, plugins, etc.
- Once completed, change web daemon account id back to the original shell (e.g. /sbin/nologin)

## Maintainers

AndrewSimon

### Copyright and license

Copyright 2015, Andrew Simon (asimon@asimon.net)

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this work except in compliance with the License. You may obtain a copy of the License in the LICENSE file, or at:

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
